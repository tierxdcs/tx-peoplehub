<main class="admin-shell">
  <form class="admin-form" (submit)="save($event)">
    <header class="admin-topbar">
      <div>
        <p class="eyebrow">Admin console</p>
        <h1>HR data entry</h1>
        <p class="subtitle">
          Capture employee records, org structure, and compliance details in one
          place.
        </p>
      </div>
      <div class="actions">
        <a class="ghost button-link" routerLink="/">Back to home</a>
        <a class="ghost button-link" routerLink="/admin/assign-training">Assign training</a>
        <button class="primary" type="submit">Save changes</button>
      </div>
    </header>

    <div class="save-banner" [class.show]="savedMessage" role="status">
      {{ savedMessage || 'Changes saved to draft.' }}
    </div>

    <section class="admin-grid">
    <article class="panel equal-card">
      <div class="panel-header">
        <h2>Employee profile</h2>
        <span class="pill">Required</span>
      </div>
      <div class="form-grid">
        <label>
          Full name
          <input
            type="text"
            name="fullName"
            placeholder="First and last name"
            required
            [(ngModel)]="adminData.fullName"
          />
        </label>
        <label>
          Employee ID
          <input
            type="text"
            name="employeeId"
            placeholder="TX-24819"
            required
            [(ngModel)]="adminData.employeeId"
          />
        </label>
        <label>
          Work email
          <input
            type="email"
            name="email"
            placeholder="name@tierx.com"
            required
            [(ngModel)]="adminData.email"
          />
        </label>
        <label>
          Location
          <select name="location" required [(ngModel)]="adminData.location">
            <option>Bengaluru</option>
            <option>Hyderabad</option>
            <option>Chennai</option>
            <option>Mumbai</option>
            <option>Delhi NCR</option>
            <option>Pune</option>
            <option>Kolkata</option>
            <option>Ahmedabad</option>
            <option>Kochi</option>
            <option>Jaipur</option>
            <option>Indore</option>
            <option>Coimbatore</option>
          </select>
        </label>
        <label>
          Department
          <select
            name="department"
            required
            [(ngModel)]="adminData.department"
          >
            @if (teams.length) {
              @for (team of teams; track team.id) {
                <option [value]="team.name">{{ team.name }}</option>
              }
            } @else {
              <option value="">No teams created yet</option>
            }
          </select>
        </label>
        <label>
          Start date
          <input
            type="date"
            name="startDate"
            required
            [(ngModel)]="adminData.startDate"
          />
        </label>
        <label>
          Role
          <select name="role" required [(ngModel)]="adminData.role">
            <option>Employee</option>
            <option>Manager</option>
            <option>Admin</option>
            <option>Superadmin</option>
          </select>
        </label>
        <label>
          Temporary password
          <input
            type="password"
            name="profilePassword"
            placeholder="Set initial password"
            [(ngModel)]="createPassword"
          />
        </label>
        <div class="form-actions">
          <button class="primary" type="button" (click)="createUserFromProfile()">
            Create user
          </button>
        </div>
      </div>
    </article>

    <article class="panel equal-card">
      <div class="panel-header">
        <h2>Role & reporting</h2>
        <span class="pill soft">Org</span>
      </div>
      <div class="form-grid">
        <label>
          Job title
          <input
            type="text"
            name="jobTitle"
            placeholder="Network Operations Manager"
            [(ngModel)]="adminData.jobTitle"
          />
        </label>
        <label>
          Manager
          <input
            type="text"
            name="manager"
            placeholder="Search by name"
            [(ngModel)]="adminData.manager"
          />
        </label>
        <label>
          Manager level 2
          <input
            type="text"
            name="managerLevel2"
            placeholder="Skip-level manager"
            [(ngModel)]="adminData.managerLevel2"
          />
        </label>
        <label>
          Manager level 3
          <input
            type="text"
            name="managerLevel3"
            placeholder="Division leader"
            [(ngModel)]="adminData.managerLevel3"
          />
        </label>
        <label>
          Manager level 4
          <input
            type="text"
            name="managerLevel4"
            placeholder="Executive sponsor"
            [(ngModel)]="adminData.managerLevel4"
          />
        </label>
        <label>
          CEO
          <input
            type="text"
            name="ceo"
            placeholder="Chief Executive Officer"
            [(ngModel)]="adminData.ceo"
          />
        </label>
        <label>
          Employment type
          <select
            name="employmentType"
            [(ngModel)]="adminData.employmentType"
          >
            <option>Full-time</option>
            <option>Part-time</option>
            <option>Contractor</option>
            <option>Intern</option>
          </select>
        </label>
        <label>
          Status
          <select name="status" [(ngModel)]="adminData.status">
            <option>Active</option>
            <option>On leave</option>
            <option>Pending</option>
            <option>Separated</option>
          </select>
        </label>
      <label>
        Director
        <select name="director" [(ngModel)]="adminData.director">
          <option>Yes</option>
          <option>No</option>
        </select>
      </label>
        <label>
          Cost center
          <input
            type="text"
            name="costCenter"
            placeholder="OPS-401"
            required
            [(ngModel)]="adminData.costCenter"
          />
        </label>
      </div>
    </article>

    <article class="panel">
      <div class="panel-header">
        <h2>Compensation & benefits</h2>
        <span class="pill">Payroll</span>
      </div>
      <div class="form-grid">
        <label>
          Base salary
          <input
            type="number"
            name="baseSalary"
            placeholder="â‚¹85,000"
            required
            [(ngModel)]="adminData.baseSalary"
          />
        </label>
        <label>
          Pay schedule
          <select
            name="paySchedule"
            required
            [(ngModel)]="adminData.paySchedule"
          >
            <option>Bi-weekly</option>
            <option>Monthly</option>
            <option>Weekly</option>
          </select>
        </label>
        <label>
          Bonus eligibility
          <select
            name="bonusEligible"
            required
            [(ngModel)]="adminData.bonusEligible"
          >
            <option>Yes</option>
            <option>No</option>
          </select>
        </label>
        <label>
          Equity plan
          <select
            name="equityPlan"
            required
            [(ngModel)]="adminData.equityPlan"
          >
            <option>Not eligible</option>
            <option>Eligible</option>
          </select>
        </label>
        <label>
          Benefits tier
          <select
            name="benefitsTier"
            required
            [(ngModel)]="adminData.benefitsTier"
          >
            <option>Standard</option>
            <option>Premium</option>
            <option>Executive</option>
          </select>
        </label>
        <label>
          Effective date
          <input
            type="date"
            name="compensationEffectiveDate"
            required
            [(ngModel)]="adminData.compensationEffectiveDate"
          />
        </label>
        <label>
          Comp band
          <input
            type="text"
            name="compBand"
            placeholder="Ops-4"
            required
            [(ngModel)]="adminData.compBand"
          />
        </label>
        <label>
          Positioning
          <select
            name="compPositioning"
            required
            [(ngModel)]="adminData.compPositioning"
          >
            <option>Mid-senior</option>
            <option>Junior</option>
            <option>Midpoint</option>
            <option>Senior</option>
          </select>
        </label>
        <label class="upload">
          Offer letter
          <input
            type="file"
            name="offerLetter"
            [required]="!adminData.offerLetterName"
            (change)="onOfferLetterSelected($event)"
          />
        </label>
        @if (adminData.offerLetterName) {
          <span class="file-name">Uploaded: {{ adminData.offerLetterName }}</span>
        }
      </div>
    </article>

    <article class="panel">
      <div class="panel-header">
        <h2>Leave allowances</h2>
        <span class="pill soft">Time off</span>
      </div>
      <div class="form-grid">
        <label>
          Annual PTO (days)
          <input
            type="number"
            name="annualPto"
            placeholder="15"
            required
            [(ngModel)]="adminData.annualPto"
          />
        </label>
        <label>
          Sick leave (days)
          <input
            type="number"
            name="sickLeave"
            placeholder="10"
            required
            [(ngModel)]="adminData.sickLeave"
          />
        </label>
        <label>
          Floating holidays
          <input
            type="number"
            name="floatingHolidays"
            placeholder="3"
            required
            [(ngModel)]="adminData.floatingHolidays"
          />
        </label>
        <label>
          Parental leave (weeks)
          <input
            type="number"
            name="parentalLeave"
            placeholder="6"
            required
            [(ngModel)]="adminData.parentalLeave"
          />
        </label>
        <label>
          Carryover cap (days)
          <input
            type="number"
            name="carryoverCap"
            placeholder="5"
            required
            [(ngModel)]="adminData.carryoverCap"
          />
        </label>
        <label>
          Policy effective
          <input
            type="date"
            name="policyEffective"
            required
            [(ngModel)]="adminData.policyEffective"
          />
        </label>
      </div>
    </article>

    <article class="panel">
      <div class="panel-header">
        <h2>Compliance & credentials</h2>
        <span class="pill">Audit</span>
      </div>
      <div class="form-grid">
        <label>
          Certifications
          <input
            type="text"
            name="certifications"
            placeholder="OSHA, Network+, Security+"
            required
            [(ngModel)]="adminData.certifications"
          />
        </label>
        <label>
          Background check
          <select
            name="backgroundCheck"
            required
            [(ngModel)]="adminData.backgroundCheck"
          >
            <option>Verified</option>
            <option>Pending</option>
            <option>Not required</option>
          </select>
        </label>
        <label>
          Safety training
          <select
            name="safetyTraining"
            required
            [(ngModel)]="adminData.safetyTraining"
          >
            <option>Completed</option>
            <option>In progress</option>
            <option>Not started</option>
          </select>
        </label>
        <label>
          Work authorization
          <select
            name="workAuthorization"
            required
            [(ngModel)]="adminData.workAuthorization"
          >
            <option>Valid</option>
            <option>Pending</option>
            <option>Expired</option>
          </select>
        </label>
        <label class="upload">
          Upload documents
          <input
            type="file"
            name="complianceDocument"
            [required]="!adminData.complianceDocumentName"
            (change)="onFileSelected($event)"
          />
        </label>
        @if (adminData.complianceDocumentName) {
          <span class="file-name"
            >Last uploaded: {{ adminData.complianceDocumentName }}</span
          >
        }
        <label>
          Next audit date
          <input
            type="date"
            name="nextAuditDate"
            required
            [(ngModel)]="adminData.nextAuditDate"
          />
        </label>
      </div>
    </article>

    <article class="panel">
      <div class="panel-header">
        <h2>Onboarding checklist</h2>
        <span class="pill soft">Workflow</span>
      </div>
      <div class="checklist">
        <div class="checklist-row">
          <label>
            <input
              type="checkbox"
              name="checklistOffer"
              required
              [(ngModel)]="adminData.checklistOffer"
            />
            Offer letter signed
          </label>
          <select
            name="checklistOfferOwner"
            required
            [(ngModel)]="adminData.checklistOfferOwner"
          >
            <option value="" disabled>Select manager</option>
            @for (manager of managerOptions; track manager) {
              <option [value]="manager">{{ manager }}</option>
            }
          </select>
        </div>
        <div class="checklist-row">
          <label>
            <input
              type="checkbox"
              name="checklistEquipment"
              required
              [(ngModel)]="adminData.checklistEquipment"
            />
            Equipment provisioned
          </label>
          <select
            name="checklistEquipmentOwner"
            required
            [(ngModel)]="adminData.checklistEquipmentOwner"
          >
            <option value="" disabled>Select manager</option>
            @for (manager of managerOptions; track manager) {
              <option [value]="manager">{{ manager }}</option>
            }
          </select>
        </div>
        <div class="checklist-row">
          <label>
            <input
              type="checkbox"
              name="checklistBadges"
              required
              [(ngModel)]="adminData.checklistBadges"
            />
            Access badges issued
          </label>
          <select
            name="checklistBadgesOwner"
            required
            [(ngModel)]="adminData.checklistBadgesOwner"
          >
            <option value="" disabled>Select manager</option>
            @for (manager of managerOptions; track manager) {
              <option [value]="manager">{{ manager }}</option>
            }
          </select>
        </div>
        <div class="checklist-row">
          <label>
            <input
              type="checkbox"
              name="checklistOrientation"
              required
              [(ngModel)]="adminData.checklistOrientation"
            />
            Orientation scheduled
          </label>
          <select
            name="checklistOrientationOwner"
            required
            [(ngModel)]="adminData.checklistOrientationOwner"
          >
            <option value="" disabled>Select manager</option>
            @for (manager of managerOptions; track manager) {
              <option [value]="manager">{{ manager }}</option>
            }
          </select>
        </div>
        <div class="checklist-row">
          <label>
            <input
              type="checkbox"
              name="checklistBusinessCard"
              required
              [(ngModel)]="adminData.checklistBusinessCard"
            />
            Provide business card
          </label>
          <select
            name="checklistBusinessCardOwner"
            required
            [(ngModel)]="adminData.checklistBusinessCardOwner"
          >
            <option value="" disabled>Select manager</option>
            @for (manager of managerOptions; track manager) {
              <option [value]="manager">{{ manager }}</option>
            }
          </select>
        </div>
        @for (item of adminData.checklistCustom; track item.title + '-' + $index) {
          <div class="checklist-row">
            <label>
              <input
                type="checkbox"
                name="checklistCustomDone-{{ $index }}"
                [(ngModel)]="item.done"
              />
              {{ item.title }}
            </label>
            <select
              name="checklistCustomOwner-{{ $index }}"
              required
              [(ngModel)]="item.owner"
              (ngModelChange)="persistProfile()"
            >
              <option value="" disabled>Select manager</option>
              @for (manager of managerOptions; track manager) {
                <option [value]="manager">{{ manager }}</option>
              }
            </select>
            <button class="ghost small" type="button" (click)="removeChecklistItem($index)">
              Remove
            </button>
          </div>
        }
        <div class="checklist-row">
          <label>
            <input
              type="text"
              name="checklistNewTitle"
              placeholder="Add onboarding task"
              [(ngModel)]="newChecklistItem.title"
            />
          </label>
          <select
            name="checklistNewOwner"
            [(ngModel)]="newChecklistItem.owner"
          >
            <option value="" disabled>Select manager</option>
            @for (manager of managerOptions; track manager) {
              <option [value]="manager">{{ manager }}</option>
            }
          </select>
          <button
            class="ghost icon-button"
            type="button"
            aria-label="Add onboarding task"
            (click)="addChecklistItem()"
          >
            +
          </button>
        </div>
      </div>
      <button class="ghost full" type="button" (click)="assignTasks()">Assign tasks</button>
      @if (taskStatus) {
        <p class="user-status">{{ taskStatus }}</p>
      }
    </article>
    </section>
  </form>
</main>

@if (editIndex !== null) {
  <div class="modal-backdrop" (click)="closeEditUser()"></div>
  <div class="modal" role="dialog" aria-modal="true">
    <header>
      <div>
        <p class="eyebrow">User management</p>
        <h3>Edit user</h3>
      </div>
      <button class="ghost" type="button" (click)="closeEditUser()">Close</button>
    </header>
    <div class="modal-body form-grid">
      <label>
        Full name
        <input type="text" [(ngModel)]="editUser.fullName" name="editFullName" />
      </label>
      <label>
        Email
        <input type="email" [(ngModel)]="editUser.email" name="editEmail" />
      </label>
      <label>
        Department
        <input type="text" [(ngModel)]="editUser.department" name="editDepartment" />
      </label>
      <label>
        Role
        <select [(ngModel)]="editUser.role" name="editRole" disabled>
          <option>Employee</option>
          <option>Manager</option>
          <option>Admin</option>
          <option>Superadmin</option>
        </select>
      </label>
      <label>
        Status
        <select [(ngModel)]="editUser.status" name="editStatus">
          <option>Active</option>
          <option>Deactivated</option>
        </select>
      </label>
      <label>
        Director
        <select [(ngModel)]="editUser.director" name="editDirector">
          <option>Yes</option>
          <option>No</option>
        </select>
      </label>
      <label class="full">
        Temporary password
        <input
          type="password"
          [(ngModel)]="editPassword"
          name="editPassword"
          placeholder="Set a new password"
        />
      </label>
    </div>
    <div class="modal-actions">
      <button class="ghost" type="button" (click)="closeEditUser()">Cancel</button>
      <button class="primary" type="button" (click)="saveEditUser()">Save user</button>
    </div>
  </div>
}
