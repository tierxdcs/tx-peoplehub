<main class="profile-shell">
  <header class="profile-topbar">
    <div class="brand">
      <span class="product">tx-peoplehub</span>
      <span class="org">TierX Data Center Solutions</span>
    </div>
    <nav class="breadcrumbs">
      <a routerLink="/">Home</a>
      <span>/</span>
      <span>People</span>
      <span>/</span>
      <span>{{ profile.name }}</span>
    </nav>
    <div class="actions">
      <a class="ghost button-link" routerLink="/">Back to home</a>
    </div>
  </header>

  <section class="profile-hero">
    <div class="profile-photo">
      <img
        [src]="profile.photoUrl"
        [alt]="profile.name"
        class="profile-image"
      />
      @if (canEditPhoto) {
        <label class="upload">
          Change photo
          <input type="file" accept="image/*" (change)="onPhotoSelected($event)" />
        </label>
      }
    </div>
    <div class="summary">
      <p class="eyebrow">Employee profile</p>
      <h1>{{ profile.name }}</h1>
      <p class="subtitle">{{ profile.title }}</p>
      <p class="contact">{{ employeeProfile?.email || 'Not set' }}</p>
      <div class="badges">
        <span>{{ profile.location }}</span>
        <span>{{ profile.team }}</span>
        <span>{{ profile.status }}</span>
      </div>
      <div class="meta">
        <div>
          <span class="label">Manager</span>
          <span class="value">{{ profile.manager }}</span>
        </div>
        <div>
          <span class="label">Employee ID</span>
          <span class="value">{{ employeeProfile?.employeeId || 'Not set' }}</span>
        </div>
        <div>
          <span class="label">Tenure</span>
          <span class="value">{{ profile.tenure }}</span>
        </div>
        <div>
          <span class="label">Role</span>
          <span class="value">Manager</span>
        </div>
      </div>
    </div>
    <div class="profile-card">
      <div class="card-header">
        <span>Engagement</span>
        <span class="pill">Q4 cycle</span>
      </div>
      <div class="score">
        <span class="value">
          {{ profile.engagementPercent === null ? 'N/A' : profile.engagementPercent + '%' }}
        </span>
        <span class="label">Engagement score</span>
      </div>
      <div class="progress">
        <div class="bar" [style.width.%]="profile.engagementProgress"></div>
      </div>
      <div class="stat-grid">
        <div>
          <span class="label">Goals on track</span>
          <span class="value">92%</span>
        </div>
        <div>
          <span class="label">Feedback</span>
          <span class="value">16 notes</span>
        </div>
      </div>
    </div>
  </section>

  <section class="profile-grid">
    <article class="panel reporting-tree">
      <div class="panel-header">
        <h2>Reporting tree</h2>
      </div>
      <div class="tree">
        <div class="tree-chain">
          @if (profile.managerChain.length) {
            @for (leader of profile.managerChain; track leader) {
              <div class="tree-node manager">
                <span class="label">@if ($index === 0) {CEO} @else if ($index === profile.managerChain.length - 1) {Manager} @else {Leader}</span>
                <strong>{{ leader }}</strong>
              </div>
            }
          } @else {
            <div class="tree-node manager">
              <span class="label">Manager</span>
              <strong>{{ profile.manager }}</strong>
            </div>
          }
        </div>
        <div class="tree-node self">
          <span class="label">You</span>
          <strong>{{ profile.name }}</strong>
          <span class="role">{{ profile.title }}</span>
        </div>
        <div class="tree-children">
          <span class="label">Direct reports</span>
          @if (directReports.length) {
            <div class="child-grid">
              @for (member of directReports; track member.name) {
                <div class="child-node">
                  <strong>{{ member.name }}</strong>
                  <span>{{ member.role }}</span>
                </div>
              }
            </div>
          } @else {
            <p class="empty">No direct reports on file.</p>
          }
        </div>
      </div>
    </article>

    @if (!hideRecentActivity) {
      <article class="panel">
        <div class="panel-header">
          <h2>Recent activity</h2>
        </div>
        @if (activityItems.length) {
          @for (item of activityItems; track item.title + item.sortDate) {
            <div class="activity">
              <span class="time">{{ item.label }}</span>
              <div>
                <strong>{{ item.title }}</strong>
                <p>{{ item.description }}</p>
              </div>
            </div>
          }
        } @else {
          <p class="empty">No recent activity yet.</p>
        }
      </article>
    }

    <article class="panel">
      <div class="panel-header">
        <h2>Compliance</h2>
      </div>
      <div class="compliance">
        <div>
          <div class="label-row">
            <span class="label">Certifications</span>
            <span class="value">{{ profile.certifications.length }} active</span>
          </div>
          @if (profile.certifications.length) {
            <ul class="certifications">
              @for (cert of profile.certifications; track cert) {
                <li>{{ cert }}</li>
              }
            </ul>
          } @else {
            <p class="empty">No certifications on file.</p>
          }
        </div>
        <div>
          <span class="label">Background</span>
          <span class="value">Verified</span>
        </div>
        <div>
          <span class="label">Safety training</span>
          <span class="value">Completed</span>
        </div>
      </div>
    </article>
  </section>
</main>

@if (isTeamModalOpen) {
  <div class="modal-backdrop" (click)="closeTeamModal()"></div>
  <div class="modal" role="dialog" aria-modal="true">
    <header>
      <div>
        <p class="eyebrow">Team members</p>
        <h3>{{ profile.team }} · {{ profile.location }}</h3>
      </div>
      <button class="ghost" type="button" (click)="closeTeamModal()"
        >Close</button
      >
    </header>
    <div class="modal-body">
      @if (filteredTeamMembers.length) {
        @for (member of filteredTeamMembers; track member.name) {
          <div class="member-row">
            <div>
              <strong>{{ member.name }}</strong>
              <span>{{ member.role }} · {{ member.department }}</span>
            </div>
            <span class="tag">{{ member.location }}</span>
          </div>
        }
      } @else {
        <p class="empty">No team members found for this department.</p>
      }
    </div>
  </div>
}
