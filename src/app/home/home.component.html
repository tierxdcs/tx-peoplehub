<main class="shell">
  <section class="hero">
    <div class="hero-text">
      <p class="eyebrow">Enterprise HR Command Center</p>
      <h1>People operations with clarity, not chaos.</h1>
      <p class="lead">
        A unified view of talent, performance, and workforce health across
        TierX. Automate the busywork and keep every team aligned.
      </p>
      <div class="hero-actions">
        <button class="primary" type="button" routerLink="/people">
          Open People Directory
        </button>
        <button class="ghost" type="button" routerLink="/org-structure">
          Organization Structure
        </button>
      </div>
      <div class="hero-stats">
        <div>
          <span class="value">{{ activeUserCount }}</span>
          <span class="label">Active employees</span>
        </div>
        <div>
          <span class="value">{{ complianceCoverage }}%</span>
          <span class="label">Compliance coverage</span>
        </div>
        <div>
          <span class="value">{{ trainingsCompleted }}</span>
          <span class="label">Trainings completed</span>
        </div>
      </div>
    </div>
    <div class="hero-cards">
      <article class="card spotlight">
        <div class="card-header">
          <span>Employee spotlight</span>
          <span class="pill">Quarterly review</span>
        </div>
        <div class="spotlight-person">
          <div>
            <h3>{{ currentProfile?.fullName || 'Employee' }}</h3>
            <p>{{ currentProfile?.jobTitle || 'Job title' }}</p>
            <p>Employee ID: {{ currentProfile?.employeeId || 'Not set' }}</p>
            <p>{{ currentProfile?.department || 'Department' }} · {{ currentProfile?.location || 'Location' }}</p>
          </div>
        </div>
        <div class="progress">
          <div class="bar" [style.width.%]="spotlightProgress"></div>
        </div>
        <div class="spotlight-footer">
          <div>
            <span class="value">{{ spotlightScore === null ? 'N/A' : spotlightScore + '%' }}</span>
            <span class="label">Engagement score</span>
          </div>
          <a class="ghost button-link" [routerLink]="['/people', 'current']">View profile</a>
        </div>
      </article>
      <article class="card checklist">
        <div class="card-header">
          <span>Today</span>
          <span class="pill soft">{{ todayTasks.length }} due</span>
        </div>
        @if (todayTasks.length) {
          <ul>
            @for (task of todayTasks; track task.title) {
              <li>{{ task.title }}</li>
            }
          </ul>
        } @else {
          <p class="empty">No approvals to address.</p>
        }
        <button class="ghost" type="button" routerLink="/tasks">Open tasks</button>
      </article>
    </div>
  </section>

  <section class="workspace">
    <div class="panel">
      <div class="panel-header">
        <div>
          <h2>Core modules</h2>
          <p>Everything your HR team needs in one place.</p>
        </div>
      </div>
      <div class="module-grid">
        <article class="module-card" routerLink="/financials">
          <h3>My financials</h3>
          <p>Salary details, offer letter, and benefits overview.</p>
          <span class="tag">Comp & benefits</span>
        </article>
        <article class="module-card" routerLink="/reimbursement">
          <h3>Reimbursement</h3>
          <p>Submit and track expense reimbursements.</p>
          <span class="tag">{{ pendingReimbursements }} pending</span>
        </article>
        <article class="module-card" routerLink="/workforce-planning">
          <h3>Workforce Planning</h3>
          <p>Scenario planning for growth, churn, and staffing.</p>
          <span class="tag">6 forecasts</span>
        </article>
        <article class="module-card" routerLink="/compliance-training">
          <h3>Compliance and Training</h3>
          <p>Keep audits, training, and certifications current.</p>
          <span class="tag">{{ trainingsAssigned }} assigned</span>
        </article>
        <article class="module-card" (click)="openIdeas()">
          <h3>Ideas</h3>
          <p>Share product or process improvements with your manager.</p>
          <span class="tag">Submit suggestion</span>
        </article>
      </div>
    </div>

    <div class="panel insights">
      <div class="panel-header">
        <div>
          <h2>Apply for leave</h2>
          <p>Request time off and track approval status.</p>
        </div>
        <button class="ghost" type="button" (click)="openBalances()">
          View balances
        </button>
      </div>
      <form class="leave-form">
        <label>
          Leave type
          <select [(ngModel)]="leaveForm.type" name="leaveType">
            <option>PTO</option>
            <option>Sick</option>
            <option>Personal</option>
            <option>Parental</option>
          </select>
        </label>
        <label>
          Start date
          <input type="date" [(ngModel)]="leaveForm.startDate" name="leaveStart" />
        </label>
        <label>
          End date
          <input
            type="date"
            [(ngModel)]="leaveForm.endDate"
            name="leaveEnd"
            [min]="leaveForm.startDate"
          />
        </label>
        <label>
          Notes
          <textarea
            rows="3"
            placeholder="Add context for your manager"
            [(ngModel)]="leaveForm.notes"
            name="leaveNotes"
          ></textarea>
        </label>
      </form>
      <button class="primary full" type="button" (click)="submitLeave()">
        Submit request
      </button>
      @if (leaveError) {
        <p class="leave-error">{{ leaveError }}</p>
      }
      <div class="leave-requests">
        <h3>Pending approvals</h3>
        @if (pendingRequests.length) {
          @for (request of pendingRequests; track request.type + request.range; let i = $index) {
            <div class="request-row">
              <div>
                <strong>{{ request.type }}</strong>
                <span>{{ request.range }}</span>
              </div>
              <div class="request-actions">
                <span class="status">{{ request.status }}</span>
                <button
                  class="ghost small"
                  type="button"
                  (click)="cancelRequest(i)"
                >
                  Cancel request
                </button>
              </div>
            </div>
          }
        } @else {
          <p class="empty">No pending requests.</p>
        }
      </div>
    </div>
  </section>
</main>

@if (isBalanceOpen) {
  <div class="modal-backdrop" (click)="closeBalances()"></div>
  <div class="modal" role="dialog" aria-modal="true">
    <header>
      <div>
        <p class="eyebrow">Leave balances</p>
        <h3>Current balances</h3>
      </div>
      <button class="ghost" type="button" (click)="closeBalances()">
        Close
      </button>
    </header>
    <div class="modal-body">
      <div class="balance-row">
        <div>
          <strong>PTO</strong>
          <span>Available</span>
        </div>
        <span class="value">{{ formatLeaveValue(currentProfile?.annualPto) }}</span>
      </div>
      <div class="balance-row">
        <div>
          <strong>Sick</strong>
          <span>Available</span>
        </div>
        <span class="value">{{ formatLeaveValue(currentProfile?.sickLeave) }}</span>
      </div>
      <div class="balance-row">
        <div>
          <strong>Floating holidays</strong>
          <span>Available</span>
        </div>
        <span class="value">{{ formatLeaveValue(currentProfile?.floatingHolidays) }}</span>
      </div>
      <div class="balance-row">
        <div>
          <strong>Parental leave</strong>
          <span>Available</span>
        </div>
        <span class="value">{{ formatLeaveValue(currentProfile?.parentalLeave) }}</span>
      </div>
      <div class="balance-row">
        <div>
          <strong>Carryover cap</strong>
          <span>Available</span>
        </div>
        <span class="value">{{ formatLeaveValue(currentProfile?.carryoverCap) }}</span>
      </div>
    </div>
  </div>
}

@if (isIdeasOpen) {
  <div class="modal-backdrop" (click)="closeIdeas()"></div>
  <div class="modal" role="dialog" aria-modal="true">
    <header>
      <div>
        <p class="eyebrow">Ideas</p>
        <h3>Share your suggestion</h3>
        <p class="subtitle">This will be sent directly to {{ managerName }}.</p>
      </div>
      <button class="ghost" type="button" (click)="closeIdeas()">
        Close
      </button>
    </header>
    <form class="idea-form">
      <label>
        Idea title
        <input type="text" [(ngModel)]="ideaForm.title" name="ideaTitle" />
      </label>
      <label>
        Focus area
        <select [(ngModel)]="ideaForm.type" name="ideaType">
          <option>Product</option>
          <option>Process</option>
          <option>Employee experience</option>
          <option>Customer impact</option>
        </select>
      </label>
      <label class="full">
        Summary
        <textarea
          rows="4"
          [(ngModel)]="ideaForm.summary"
          name="ideaSummary"
          placeholder="Describe the idea, impact, and any supporting context."
        ></textarea>
      </label>
    </form>
    @if (ideaStatus) {
      <p class="idea-status">{{ ideaStatus }}</p>
    }
    <div class="modal-actions">
      <button class="ghost" type="button" (click)="closeIdeas()">Cancel</button>
      <button class="primary" type="button" (click)="submitIdea()">Send idea</button>
    </div>
    <div class="ideas-history">
      <h4>Submitted ideas</h4>
      @if (ideaHistory.length) {
        <div class="ideas-list">
          @for (idea of ideaHistory; track idea.title + idea.submittedAt) {
            <div class="idea-row">
              <div>
                <strong>{{ idea.title }}</strong>
                <span>{{ idea.type }} · {{ idea.manager }}</span>
              </div>
              <span class="tag">{{ idea.submittedAt | date : 'mediumDate' }}</span>
            </div>
          }
        </div>
      } @else {
        <p class="empty">No ideas submitted yet.</p>
      }
    </div>
  </div>
}
