<main class="tasks-shell">
  <header class="tasks-topbar">
    <div>
      <p class="eyebrow">Tasks</p>
      <h1>Open tasks</h1>
      <p class="subtitle">Track HR and operational tasks in one place.</p>
    </div>
    <div class="actions">
      <a class="ghost button-link" routerLink="/">Back to home</a>
    </div>
  </header>

  <section class="tasks-list">
    <div class="section-header">
      <h2>Pending approvals</h2>
      <span class="pill">{{ approvals.length }} open</span>
    </div>
    @if (approvals.length) {
      @for (task of approvals; track task.id) {
        <button
          class="task-card"
          type="button"
          (click)="openTask(task, false)"
        >
          <div>
            <strong>{{ task.title }}</strong>
            @if (task.owner) {
              <span>{{ task.owner }}</span>
            }
          </div>
          <span class="pill">{{ task.due }}</span>
        </button>
      }
    } @else {
      <p class="empty">No approvals awaiting review.</p>
    }
  </section>

  <section class="tasks-list">
    <div class="section-header">
      <h2>Completed approvals</h2>
      <span class="pill soft">{{ completed.length }} done</span>
    </div>
    @if (completed.length) {
      @for (task of completed; track task.id) {
        <button class="task-card done" type="button" (click)="openTask(task, true)">
          <div>
            <strong>{{ task.title }}</strong>
            @if (task.owner) {
              <span>{{ task.owner }}</span>
            }
          </div>
          <span class="pill">{{ task.status }}</span>
        </button>
      }
    } @else {
      <p class="empty">No completed approvals yet.</p>
    }
  </section>
</main>

@if (selectedTask) {
  <div class="modal-backdrop" (click)="closeTask()"></div>
  <div class="modal" role="dialog" aria-modal="true">
    <header>
      <div>
        <p class="eyebrow">Approval detail</p>
        <h3>{{ selectedTask.title }}</h3>
        <p class="subtitle">
          @if (selectedTask.owner) {
            {{ selectedTask.owner }} ·
          }
          {{ selectedTask.due }}
          @if (selectedTask.requestNote) {
            · Note: {{ selectedTask.requestNote }}
          }
        </p>
      </div>
      <button class="ghost" type="button" (click)="closeTask()">Close</button>
    </header>
    <div class="modal-body">
      <div class="detail-row">
        <span>Status</span>
        <strong>{{ selectedTask.status }}</strong>
      </div>
      <div class="detail-row">
        <span>Requested by</span>
        <strong>{{ selectedTask.owner || 'Not specified' }}</strong>
      </div>
      <div class="detail-row">
        <span>Details</span>
        <strong>
          {{ selectedTask.due }}
          @if (selectedTask.requestNote) {
            <small>Note: {{ selectedTask.requestNote }}</small>
          }
        </strong>
      </div>
    </div>
    <div class="modal-actions">
      @if (!selectedTask.isCompleted) {
        <a
          class="primary button-link"
          [routerLink]="['/approvals']"
          [queryParams]="{ open: selectedTask.id }"
        >
          Open approval
        </a>
      } @else {
        <button class="primary" type="button" (click)="closeTask()">Done</button>
      }
    </div>
  </div>
}
