<main class="reimbursement-ops">
  <header class="reimbursement-ops__header">
    <div>
      <p class="eyebrow">Reimbursement</p>
      <h1>COO approvals</h1>
      <p class="subtitle">Close approved reimbursement claims.</p>
    </div>
    <div class="actions">
      <a class="ghost button-link" routerLink="/">Back to home</a>
    </div>
  </header>

  @if (!isAuthorized) {
    <p class="empty">{{ statusMessage }}</p>
  } @else {
    @if (statusMessage) {
      <p class="empty">{{ statusMessage }}</p>
    } @else {
      <section class="reimbursement-section">
        <div class="section-header">
          <h2>Approved reimbursements</h2>
          <span class="pill">{{ approvals.length }}</span>
        </div>
        @if (approvals.length) {
          <div class="reimbursement-ops__list">
            @for (item of approvals; track item.id) {
              <article class="reimbursement-card">
                <div class="reimbursement-card__top">
                  <div>
                    <span class="pill soft">Approved</span>
                    <strong>Reimbursement · {{ item.category }}</strong>
                    <span class="meta">{{ item.employee || 'Employee' }}</span>
                  </div>
                  <div class="amount">₹{{ item.amount }}</div>
                </div>
                @if (item.notes) {
                  <div class="note-card">
                    <span>Request note</span>
                    <p>{{ item.notes }}</p>
                  </div>
                }
                <div class="reimbursement-card__actions">
                  <label>
                    Status
                    <select [(ngModel)]="item.statusChoice">
                      <option value="Reimbursement complete">Reimbursement complete</option>
                    </select>
                  </label>
                  <label>
                    Completion note
                    <textarea
                      rows="2"
                      placeholder="Add completion note"
                      [(ngModel)]="item.note"
                    ></textarea>
                  </label>
                  <div class="actions-row">
                    @if (item.error) {
                      <p class="error">{{ item.error }}</p>
                    }
                    <button
                      class="primary"
                      type="button"
                      (click)="submitDecision(item)"
                      [disabled]="item.saving"
                    >
                      {{ item.saving ? 'Saving…' : 'Mark complete' }}
                    </button>
                  </div>
                </div>
              </article>
            }
          </div>
        } @else {
          <p class="empty">No approved reimbursements awaiting completion.</p>
        }
      </section>

      <section class="reimbursement-section">
        <div class="section-header">
          <h2>Reimbursement updates</h2>
          <span class="pill soft">{{ completed.length }}</span>
        </div>
        @if (completed.length) {
          <div class="reimbursement-ops__list">
            @for (item of completed; track item.id) {
              <article class="reimbursement-card done">
                <div class="reimbursement-card__top">
                  <div>
                    <span class="pill">Reimbursement complete</span>
                    <strong>Reimbursement · {{ item.category }}</strong>
                    <span class="meta">{{ item.employee || 'Employee' }}</span>
                  </div>
                  <div class="amount">₹{{ item.amount }}</div>
                </div>
                @if (item.notes) {
                  <div class="note-card">
                    <span>Request note</span>
                    <p>{{ item.notes }}</p>
                  </div>
                }
              </article>
            }
          </div>
        } @else {
          <p class="empty">No reimbursement updates logged yet.</p>
        }
      </section>
    }
  }
</main>
