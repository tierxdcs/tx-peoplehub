<main class="approvals-shell">
  <header class="approvals-topbar">
    <div>
      <p class="eyebrow">Approvals</p>
      <h1>Open approvals</h1>
      <p class="subtitle">Review pending requests and take action.</p>
    </div>
    <div class="actions">
      <a class="ghost button-link" routerLink="/tasks">Back to open tasks</a>
    </div>
  </header>

  <section class="panel">
    <div class="panel-header">
      <h2>Approval details</h2>
      <span class="pill">{{ requests.length }} open</span>
    </div>
    @if (!isDirector) {
      <p class="empty">Approvals are available to Directors only.</p>
    } @else {
      <p class="empty">
        Open a task from the Open tasks list to review and approve it.
      </p>
    }
  </section>
</main>

@if (selectedRequest) {
  <div class="modal-backdrop" (click)="closeRequest()"></div>
  <div class="modal" role="dialog" aria-modal="true">
    <header>
      <div>
        <p class="eyebrow">Approval detail</p>
        <h3>{{ selectedRequest.title }}</h3>
        <p class="subtitle">
          @if (selectedRequest.submittedBy) {
            {{ selectedRequest.submittedBy }} ·
          }
          {{ selectedRequest.summary }}
          @if (selectedRequest.requestNote) {
            · Note: {{ selectedRequest.requestNote }}
          }
        </p>
      </div>
      <button class="ghost" type="button" (click)="closeRequest()">Close</button>
    </header>
    <div class="modal-body">
      <div class="detail-row">
        <span>Status</span>
        <strong>{{ selectedRequest.status }}</strong>
      </div>
      <div class="detail-row">
        <span>Requested by</span>
        <strong>
          @if (selectedRequest.submittedBy) {
            {{ selectedRequest.submittedBy }}
          } @else {
            Not specified
          }
        </strong>
      </div>
      <div class="detail-row">
        <span>Details</span>
        <strong>{{ selectedRequest.summary }}</strong>
      </div>
      <div class="detail-row">
        <span>Requestor note</span>
        <strong>
          @if (selectedRequest.requestNote) {
            {{ selectedRequest.requestNote }}
          } @else {
            Not provided
          }
        </strong>
      </div>
      <div class="notes">
        <label>
          Reviewer notes
          <textarea
            rows="3"
            placeholder="Add any decision context"
            [(ngModel)]="decisionNote"
            name="decisionNote"
          ></textarea>
        </label>
        @if (noteError) {
          <p class="note-error">{{ noteError }}</p>
        }
      </div>
    </div>
    <div class="modal-actions">
      <button class="ghost" type="button" (click)="rejectRequest()">Reject</button>
      <button class="primary" type="button" (click)="approveRequest()">Approve</button>
    </div>
  </div>
}
